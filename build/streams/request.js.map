{"version":3,"sources":["../../src/streams/request.js"],"names":["Writable","Request","constructor","id","socket","req","_socket","_id","emit","_write","data","enc","next","conn","once","_writev","_final","_destroy","err","message"],"mappings":"AAAA,SAASA,QAAT,QAAyB,QAAzB;;AAEA,eAAe,MAAMC,OAAN,SAAsBD,QAAtB,CAA+B;AAC5CE,cAAY,EAAEC,EAAF,EAAMC,MAAN,EAAcC,GAAd,EAAZ,EAAiC;AAC/B;AACA,SAAKC,OAAL,GAAeF,MAAf;AACA,SAAKG,GAAL,GAAWJ,EAAX;AACA,SAAKG,OAAL,CAAaE,IAAb,CAAkB,SAAlB,EAA6BL,EAA7B,EAAiCE,GAAjC;AACD;;AAED;;;;;AAKAI,SAAOC,IAAP,EAAaC,GAAb,EAAkBC,IAAlB,EAAwB;AACtB,SAAKN,OAAL,CAAaE,IAAb,CAAkB,cAAlB,EAAkC,KAAKD,GAAvC,EAA4CG,IAA5C;AACA,SAAKJ,OAAL,CAAaO,IAAb,CAAkBC,IAAlB,CAAuB,OAAvB,EAAgC,MAAM;AACpCF;AACD,KAFD;AAGD;;AAED;;;;;;;;AASAG,UAAQL,IAAR,EAAcE,IAAd,EAAoB;AAClB,SAAKN,OAAL,CAAaE,IAAb,CAAkB,eAAlB,EAAmC,KAAKD,GAAxC,EAA6CG,IAA7C;AACA,SAAKJ,OAAL,CAAaO,IAAb,CAAkBC,IAAlB,CAAuB,OAAvB,EAAgC,MAAM;AACpCF;AACD,KAFD;AAGD;;AAEDI,SAAOJ,IAAP,EAAa;AACX,SAAKN,OAAL,CAAaE,IAAb,CAAkB,kBAAlB,EAAsC,KAAKD,GAA3C;AACA,SAAKD,OAAL,CAAaO,IAAb,CAAkBC,IAAlB,CAAuB,OAAvB,EAAgC,MAAM;AACpCF;AACD,KAFD;AAGD;;AAEDK,WAASC,GAAT,EAAcN,IAAd,EAAoB;AAClB,QAAIM,GAAJ,EAAS;AACP,WAAKZ,OAAL,CAAaE,IAAb,CAAkB,oBAAlB,EAAwC,KAAKD,GAA7C,EAAkDW,OAAOA,IAAIC,OAA7D;AACA,WAAKb,OAAL,CAAaO,IAAb,CAAkBC,IAAlB,CAAuB,OAAvB,EAAgC,MAAM;AACpCF;AACD,OAFD;AAGA;AACD;AACDA;AACD;AApD2C","file":"request.js","sourcesContent":["import { Writable } from \"stream\";\n\nexport default class Request extends Writable {\n  constructor({ id, socket, req }) {\n    super();\n    this._socket = socket;\n    this._id = id;\n    this._socket.emit(\"request\", id, req);\n  }\n\n  /*\n  This is a method for writing streams as well but\n  it gets deprioritized - for _writev - when a stream contains\n  multiple chunks to be written at once.\n  */\n  _write(data, enc, next) {\n    this._socket.emit(\"inbound-pipe\", this._id, data);\n    this._socket.conn.once(\"drain\", () => {\n      next();\n    });\n  }\n\n  /* \n  For processing multiple chunks at once.From the Node docs:\n  If a stream implementation is capable of processing \n  multiple chunks of data at once, \n  the writable._writev() method should be implemented.\n\n  Within the context of the app, it accepts the data - in chunks - that \n  will be sent to the local server\n  */\n  _writev(data, next) {\n    this._socket.emit(\"inbound-pipes\", this._id, data);\n    this._socket.conn.once(\"drain\", () => {\n      next();\n    });\n  }\n\n  _final(next) {\n    this._socket.emit(\"inbound-pipe-end\", this._id);\n    this._socket.conn.once(\"drain\", () => {\n      next();\n    });\n  }\n\n  _destroy(err, next) {\n    if (err) {\n      this._socket.emit(\"inbound-pipe-error\", this._id, err && err.message);\n      this._socket.conn.once(\"drain\", () => {\n        next();\n      });\n      return;\n    }\n    next();\n  }\n}\n"]}